<!DOCTYPE html>
<html>
<body style="background:#0f0f0f;color:#fff;font-family:sans-serif;padding:20px">
<h2>Slime Sheet → Individual Transparent PNGs (Save manually)</h2>
<input type="file" id="file" accept="image/*"><br><br>
<div id="out" style="display:grid;grid-template-columns:repeat(auto-fill,90px);gap:14px"></div>

<canvas id="c" style="display:none"></canvas>

<script>
const cols = 8;   // number per row in sheet
const rows = 6;   // number of rows
const padding = 4;

const fileInput = document.getElementById("file");
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const out = document.getElementById("out");

fileInput.onchange = () => {
  const img = new Image();
  img.onload = ()=>process(img);
  img.src = URL.createObjectURL(fileInput.files[0]);
};

function process(img){
  out.innerHTML = "";
  const cellW = img.width/cols;
  const cellH = img.height/rows;

  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      canvas.width = cellW;
      canvas.height = cellH;
      ctx.clearRect(0,0,cellW,cellH);
      ctx.drawImage(img,c*cellW,r*cellH,cellW,cellH,0,0,cellW,cellH);

      // remove black background
      const d = ctx.getImageData(0,0,cellW,cellH);
      for(let i=0;i<d.data.length;i+=4){
        const R=d.data[i],G=d.data[i+1],B=d.data[i+2];
        if(R<10 && G<10 && B<10) d.data[i+3]=0;
      }
      ctx.putImageData(d,0,0);

      // trim
      const trimmed = trim(canvas);
      const url = trimmed.toDataURL("image/png");

      const imgEl = document.createElement("img");
      imgEl.src = url;
      imgEl.style.width="80px";
      imgEl.style.height="80px";
      imgEl.style.objectFit="contain";
      imgEl.title = "Right-click → Save image as…";
      out.appendChild(imgEl);
    }
  }
}

function trim(src){
  const w=src.width,h=src.height;
  const d=src.getContext("2d").getImageData(0,0,w,h).data;
  let x1=w,y1=h,x2=0,y2=0;
  for(let y=0;y<h;y++)for(let x=0;x<w;x++){
    const a=d[(y*w+x)*4+3];
    if(a>5){ if(x<x1)x1=x; if(y<y1)y1=y; if(x>x2)x2=x; if(y>y2)y2=y; }
  }
  const cw=Math.max(1,(x2-x1)+1+padding*2);
  const ch=Math.max(1,(y2-y1)+1+padding*2);
  const out=document.createElement("canvas");
  out.width=cw; out.height=ch;
  out.getContext("2d").drawImage(src,x1-padding,y1-padding,cw,ch,0,0,cw,ch);
  return out;
}
</script>
</body>
</html>
